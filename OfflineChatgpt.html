<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Offline Local AI Chatbot - Point Wise</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#0d1117; color:white; display:flex; height:100vh; }
    .chatbox { flex:1; display:flex; flex-direction:column; padding:20px; }
    .messages { flex:1; overflow-y:auto; padding:10px; }
    .msg { margin:8px 0; padding:10px 14px; border-radius:10px; max-width:70%; }
    .user { background:#0369a1; align-self:flex-end; }
    .assistant { background:#1e293b; align-self:flex-start; }
    .input-area { display:flex; gap:10px; }
    textarea { flex:1; border-radius:8px; padding:10px; background:#111827; color:white; border:none; resize:none; }
    button { padding:10px 20px; border:none; border-radius:8px; background:#ff3ca6; color:white; font-weight:bold; cursor:pointer; }
    ul { margin:0; padding-left:20px; }
  </style>
</head>
<body>
  <div class="chatbox">
    <div class="messages" id="messages"></div>
    <div class="input-area">
      <textarea id="userInput" placeholder="Type a message..."></textarea>
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <script>
    async function sendMessage() {
      const inputEl = document.getElementById("userInput");
      const msgBox = document.getElementById("messages");
      const userText = inputEl.value.trim();
      if (!userText) return;

      // User message
      let userDiv = document.createElement("div");
      userDiv.className = "msg user";
      userDiv.textContent = userText;
      msgBox.appendChild(userDiv);
      inputEl.value = "";

      // Assistant placeholder
      let responseDiv = document.createElement("div");
      responseDiv.className = "msg assistant";
      responseDiv.innerHTML = "<i>Thinking...</i>";
      msgBox.appendChild(responseDiv);
      msgBox.scrollTop = msgBox.scrollHeight;

      try {
        const res = await fetch("http://localhost:11434/api/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ model: "llama2", prompt: userText })
        });

        const reader = res.body.getReader();
        let output = "";
        while (true) {
          const { done, value } = await reader.read();
          if (done) break;
          const text = new TextDecoder().decode(value);
          text.split("\n").forEach(line => {
            if (line.trim()) {
              try {
                const json = JSON.parse(line);
                if (json.response) {
                  output += json.response;

                  // Convert response into point-wise list
                  const points = output.split(/(\d+\.\s)|(-\s)/).filter(p => p && p.trim() !== "");
                  let html = "<ul>";
                  points.forEach(pt => {
                    html += "<li>" + pt.trim() + "</li>";
                  });
                  html += "</ul>";
                  responseDiv.innerHTML = html;
                  msgBox.scrollTop = msgBox.scrollHeight;
                }
              } catch {}
            }
          });
        }
      } catch (err) {
        responseDiv.textContent = "Error: " + err.message;
      }
    }
  </script>
</body>
</html>
